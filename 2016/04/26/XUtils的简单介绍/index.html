<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>XUtils的简单介绍 | Hexo</title>
  <meta name="author" content="Xiaobo Hu" />

  
  <meta name="description" content="xUtils3简介
xUtils 包含了很多实用的android工具.
xUtils 支持超大文件(超过2G)上传，更全面的http请求协议支持(11种谓词)，拥有更加灵活的ORM，更多的事件注解支持且不受混淆影响…
xUtils 最低兼容Android 4.0 (api level 14). (A" />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <meta property="og:title" content="XUtils的简单介绍" />
  <meta property="og:site_name" content="Hexo" />

  
  

  
    <meta property="og:image" content="undefined" />
  

  
  <link href="/css/images/favicon.ico" rel="icon" />
  

  <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  


  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Hexo</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="[layout]">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-04-26T04:13:33.000Z"><a href="/2016/04/26/XUtils的简单介绍/">2016-04-26</a></time>
      
      
  
    <h1 class="title">XUtils的简单介绍</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="xUtils3简介"><a href="#xUtils3简介" class="headerlink" title="xUtils3简介"></a>xUtils3简介</h2><ul>
<li>xUtils 包含了很多实用的android工具.</li>
<li>xUtils 支持超大文件(超过2G)上传，更全面的http请求协议支持(11种谓词)，拥有更加灵活的ORM，更多的事件注解支持且不受混淆影响…</li>
<li>xUtils 最低兼容Android 4.0 (api level 14). (<a href="https://github.com/wyouflf/xUtils3/issues/8" target="_blank" rel="external">Android 2.3?</a>)</li>
<li>xUtils3变化较多所以建立了新的项目不在旧版(github.com/wyouflf/xUtils)上继续维护, 相对于旧版本:<ol>
<li>HTTP实现替换HttpClient为UrlConnection, 自动解析回调泛型, 更安全的断点续传策略.</li>
<li>支持标准的Cookie策略, 区分domain, path…</li>
<li>事件注解去除不常用的功能, 提高性能.</li>
<li>数据库api简化提高性能, 达到和greenDao一致的性能.</li>
<li>图片绑定支持gif(受系统兼容性影响, 部分gif文件只能静态显示), webp; 支持圆角, 圆形, 方形等裁剪, 支持自动旋转…</li>
</ol>
</li>
</ul>
<h4 id="使用Gradle构建时添加一下依赖即可"><a href="#使用Gradle构建时添加一下依赖即可" class="headerlink" title="使用Gradle构建时添加一下依赖即可:"></a>使用Gradle构建时添加一下依赖即可:</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'org.xutils:xutils:3.3.34'</span></span><br></pre></td></tr></table></figure>
<h5 id="如果使用eclipse可以-点击这里下载aar文件-然后用zip解压-取出jar包和so文件"><a href="#如果使用eclipse可以-点击这里下载aar文件-然后用zip解压-取出jar包和so文件" class="headerlink" title="如果使用eclipse可以 点击这里下载aar文件, 然后用zip解压, 取出jar包和so文件."></a>如果使用eclipse可以 <a href="http://dl.bintray.com/wyouflf/maven/org/xutils/xutils/" target="_blank" rel="external">点击这里下载aar文件</a>, 然后用zip解压, 取出jar包和so文件.</h5><h5 id="混淆配置参考示例项目sample的配置"><a href="#混淆配置参考示例项目sample的配置" class="headerlink" title="混淆配置参考示例项目sample的配置"></a>混淆配置参考示例项目sample的配置</h5><h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题:"></a>常见问题:</h4><ol>
<li>更好的管理图片缓存: <a href="https://github.com/wyouflf/xUtils3/issues/149" target="_blank" rel="external">https://github.com/wyouflf/xUtils3/issues/149</a></li>
<li>Cookie的使用: <a href="https://github.com/wyouflf/xUtils3/issues/125" target="_blank" rel="external">https://github.com/wyouflf/xUtils3/issues/125</a></li>
<li>关于query参数? http请求可以通过 header, url, body(请求体)传参; query参数是url中问号(?)后面的参数.</li>
<li>关于body参数? body参数只有PUT, POST, PATCH, DELETE(老版本RFC2616文档没有明确指出它是否支持, 所以暂时支持)请求支持.</li>
<li>自定义Http参数对象和结果解析: <a href="https://github.com/wyouflf/xUtils3/issues/191" target="_blank" rel="external">https://github.com/wyouflf/xUtils3/issues/191</a></li>
</ol>
<h4 id="使用前配置"><a href="#使用前配置" class="headerlink" title="使用前配置"></a>使用前配置</h4><h5 id="需要的权限"><a href="#需要的权限" class="headerlink" title="需要的权限"></a>需要的权限</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在application的onCreate中初始化</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    x.Ext.init(<span class="keyword">this</span>);</span><br><span class="line">    x.Ext.setDebug(BuildConfig.DEBUG); <span class="comment">// 是否输出debug日志, 开启debug会影响性能.</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用-Event事件注解-ContentView-ViewInject等更多示例参考sample项目"><a href="#使用-Event事件注解-ContentView-ViewInject等更多示例参考sample项目" class="headerlink" title="使用@Event事件注解(@ContentView, @ViewInject等更多示例参考sample项目)"></a>使用@Event事件注解(@ContentView, @ViewInject等更多示例参考sample项目)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 1. 方法必须私有限定,</span><br><span class="line"> * 2. 方法参数形式必须和type对应的Listener接口一致.</span><br><span class="line"> * 3. 注解参数value支持数组: value=&#123;id1, id2, id3&#125;</span><br><span class="line"> * 4. 其它参数说明见&#123;<span class="doctag">@link</span> org.xutils.event.annotation.Event&#125;类的说明.</span><br><span class="line"> **/</span></span><br><span class="line"><span class="meta">@Event</span>(value = R.id.btn_test_baidu1,</span><br><span class="line">        type = View.OnClickListener.class<span class="comment">/*可选参数, 默认是View.OnClickListener.class*/</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onTestBaidu1Click</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="访问网络-更多示例参考sample项目"><a href="#访问网络-更多示例参考sample项目" class="headerlink" title="访问网络(更多示例参考sample项目)"></a>访问网络(更多示例参考sample项目)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 自定义实体参数类请参考:</span><br><span class="line"> * 请求注解 &#123;<span class="doctag">@link</span> org.xutils.http.annotation.HttpRequest&#125;</span><br><span class="line"> * 请求注解处理模板接口 &#123;<span class="doctag">@link</span> org.xutils.http.app.ParamsBuilder&#125;</span><br><span class="line"> *</span><br><span class="line"> * 需要自定义类型作为callback的泛型时, 参考:</span><br><span class="line"> * 响应注解 &#123;<span class="doctag">@link</span> org.xutils.http.annotation.HttpResponse&#125;</span><br><span class="line"> * 响应注解处理模板接口 &#123;<span class="doctag">@link</span> org.xutils.http.app.ResponseParser&#125;</span><br><span class="line"> *</span><br><span class="line"> * 示例: 查看 org.xutils.sample.http 包里的代码</span><br><span class="line"> */</span></span><br><span class="line">BaiduParams params = <span class="keyword">new</span> BaiduParams();</span><br><span class="line">params.wd = <span class="string">"xUtils"</span>;</span><br><span class="line"><span class="comment">// 有上传文件时使用multipart表单, 否则上传原始文件流.</span></span><br><span class="line"><span class="comment">// params.setMultipart(true);</span></span><br><span class="line"><span class="comment">// 上传文件方式 1</span></span><br><span class="line"><span class="comment">// params.uploadFile = new File("/sdcard/test.txt");</span></span><br><span class="line"><span class="comment">// 上传文件方式 2</span></span><br><span class="line"><span class="comment">// params.addBodyParameter("uploadFile", new File("/sdcard/test.txt"));</span></span><br><span class="line">Callback.Cancelable cancelable</span><br><span class="line">       = x.http().get(params,</span><br><span class="line">       <span class="comment">/**</span><br><span class="line">        * 1. callback的泛型:</span><br><span class="line">        * callback参数默认支持的泛型类型参见&#123;<span class="doctag">@link</span> org.xutils.http.loader.LoaderFactory&#125;,</span><br><span class="line">        * 例如: 指定泛型为File则可实现文件下载, 使用params.setSaveFilePath(path)指定文件保存的全路径.</span><br><span class="line">        * 默认支持断点续传(采用了文件锁和尾端校验续传文件的一致性).</span><br><span class="line">        * 其他常用类型可以自己在LoaderFactory中注册,</span><br><span class="line">        * 也可以使用&#123;<span class="doctag">@link</span> org.xutils.http.annotation.HttpResponse&#125;</span><br><span class="line">        * 将注解HttpResponse加到自定义返回值类型上, 实现自定义ResponseParser接口来统一转换.</span><br><span class="line">        * 如果返回值是json形式, 那么利用第三方的json工具将十分容易定义自己的ResponseParser.</span><br><span class="line">        * 如示例代码&#123;<span class="doctag">@link</span> org.xutils.sample.http.BaiduResponse&#125;, 可直接使用BaiduResponse作为</span><br><span class="line">        * callback的泛型.</span><br><span class="line">        *</span><br><span class="line">        * 2. callback的组合:</span><br><span class="line">        * 可以用基类或接口组合个种类的Callback, 见&#123;<span class="doctag">@link</span> org.xutils.common.Callback&#125;.</span><br><span class="line">        * 例如:</span><br><span class="line">        * a. 组合使用CacheCallback将使请求检测缓存或将结果存入缓存(仅GET请求生效).</span><br><span class="line">        * b. 组合使用PrepareCallback的prepare方法将为callback提供一次后台执行耗时任务的机会,</span><br><span class="line">        * 然后将结果给onCache或onSuccess.</span><br><span class="line">        * c. 组合使用ProgressCallback将提供进度回调.</span><br><span class="line">        * ...(可参考&#123;<span class="doctag">@link</span> org.xutils.image.ImageLoader&#125;</span><br><span class="line">        * 或 示例代码中的 &#123;<span class="doctag">@link</span> org.xutils.sample.download.DownloadCallback&#125;)</span><br><span class="line">        *</span><br><span class="line">        * 3. 请求过程拦截或记录日志: 参考 &#123;<span class="doctag">@link</span> org.xutils.http.app.RequestTracker&#125;</span><br><span class="line">        *</span><br><span class="line">        * 4. 请求Header获取: 参考 &#123;<span class="doctag">@link</span> org.xutils.http.app.RequestInterceptListener&#125;</span><br><span class="line">        *</span><br><span class="line">        * 5. 其他(线程池, 超时, 重定向, 重试, 代理等): 参考 &#123;<span class="doctag">@link</span> org.xutils.http.RequestParams&#125;</span><br><span class="line">        *</span><br><span class="line">        **/</span></span><br><span class="line">       <span class="keyword">new</span> Callback.CommonCallback&lt;String&gt;() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">               Toast.makeText(x.app(), result, Toast.LENGTH_LONG).show();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable ex, <span class="keyword">boolean</span> isOnCallback)</span> </span>&#123;</span><br><span class="line">               <span class="comment">//Toast.makeText(x.app(), ex.getMessage(), Toast.LENGTH_LONG).show();</span></span><br><span class="line">               <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> HttpException) &#123; <span class="comment">// 网络错误</span></span><br><span class="line">                   HttpException httpEx = (HttpException) ex;</span><br><span class="line">                   <span class="keyword">int</span> responseCode = httpEx.getCode();</span><br><span class="line">                   String responseMsg = httpEx.getMessage();</span><br><span class="line">                   String errorResult = httpEx.getResult();</span><br><span class="line">                   <span class="comment">// ...</span></span><br><span class="line">               &#125; <span class="keyword">else</span> &#123; <span class="comment">// 其他错误</span></span><br><span class="line">                   <span class="comment">// ...</span></span><br><span class="line">               &#125;</span><br><span class="line">               Toast.makeText(x.app(), ex.getMessage(), Toast.LENGTH_LONG).show();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCancelled</span><span class="params">(CancelledException cex)</span> </span>&#123;</span><br><span class="line">               Toast.makeText(x.app(), <span class="string">"cancelled"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFinished</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cancelable.cancel(); // 取消请求</span></span><br></pre></td></tr></table></figure>
<h4 id="如果你只需要一个简单的版本"><a href="#如果你只需要一个简单的版本" class="headerlink" title="如果你只需要一个简单的版本:"></a>如果你只需要一个简单的版本:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Event</span>(value = R.id.btn_test_baidu2)</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onTestBaidu2Click</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">    RequestParams params = <span class="keyword">new</span> RequestParams(<span class="string">"https://www.baidu.com/s"</span>);</span><br><span class="line">    params.setSslSocketFactory(...); <span class="comment">// 设置ssl</span></span><br><span class="line">    params.addQueryStringParameter(<span class="string">"wd"</span>, <span class="string">"xUtils"</span>);</span><br><span class="line">    x.http().get(params, <span class="keyword">new</span> Callback.CommonCallback&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(x.app(), result, Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable ex, <span class="keyword">boolean</span> isOnCallback)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(x.app(), ex.getMessage(), Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCancelled</span><span class="params">(CancelledException cex)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(x.app(), <span class="string">"cancelled"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFinished</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<h4 id="带有缓存的请求示例"><a href="#带有缓存的请求示例" class="headerlink" title="带有缓存的请求示例:"></a>带有缓存的请求示例:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">BaiduParams params = <span class="keyword">new</span> BaiduParams();</span><br><span class="line">params.wd = <span class="string">"xUtils"</span>;</span><br><span class="line"><span class="comment">// 默认缓存存活时间, 单位:毫秒.(如果服务没有返回有效的max-age或Expires)</span></span><br><span class="line">params.setCacheMaxAge(<span class="number">1000</span> * <span class="number">60</span>);</span><br><span class="line">Callback.Cancelable cancelable</span><br><span class="line">		<span class="comment">// 使用CacheCallback, xUtils将为该请求缓存数据.</span></span><br><span class="line">		= x.http().get(params, <span class="keyword">new</span> Callback.CacheCallback&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> hasError = <span class="keyword">false</span>;</span><br><span class="line">	<span class="keyword">private</span> String result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCache</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 得到缓存数据, 缓存过期后不会进入这个方法.</span></span><br><span class="line">		<span class="comment">// 如果服务端没有返回过期时间, 参考params.setCacheMaxAge(maxAge)方法.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// * 客户端会根据服务端返回的 header 中 max-age 或 expires 来确定本地缓存是否给 onCache 方法.</span></span><br><span class="line">        <span class="comment">//   如果服务端没有返回 max-age 或 expires, 那么缓存将一直保存, 除非这里自己定义了返回false的</span></span><br><span class="line">        <span class="comment">//   逻辑, 那么xUtils将请求新数据, 来覆盖它.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// * 如果信任该缓存返回 true, 将不再请求网络;</span></span><br><span class="line">        <span class="comment">//   返回 false 继续请求网络, 但会在请求头中加上ETag, Last-Modified等信息,</span></span><br><span class="line">        <span class="comment">//   如果服务端返回304, 则表示数据没有更新, 不继续加载数据.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">this</span>.result = result;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>; <span class="comment">// true: 信任缓存数据, 不在发起网络请求; false不信任缓存数据.</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 注意: 如果服务返回304 或 onCache 选择了信任缓存, 这时result为null.</span></span><br><span class="line">        <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">		    <span class="keyword">this</span>.result = result;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable ex, <span class="keyword">boolean</span> isOnCallback)</span> </span>&#123;</span><br><span class="line">		hasError = <span class="keyword">true</span>;</span><br><span class="line">		Toast.makeText(x.app(), ex.getMessage(), Toast.LENGTH_LONG).show();</span><br><span class="line">		<span class="keyword">if</span> (ex <span class="keyword">instanceof</span> HttpException) &#123; <span class="comment">// 网络错误</span></span><br><span class="line">			HttpException httpEx = (HttpException) ex;</span><br><span class="line">			<span class="keyword">int</span> responseCode = httpEx.getCode();</span><br><span class="line">			String responseMsg = httpEx.getMessage();</span><br><span class="line">			String errorResult = httpEx.getResult();</span><br><span class="line">			<span class="comment">// ...</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123; <span class="comment">// 其他错误</span></span><br><span class="line">			<span class="comment">// ...</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCancelled</span><span class="params">(CancelledException cex)</span> </span>&#123;</span><br><span class="line">		Toast.makeText(x.app(), <span class="string">"cancelled"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFinished</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!hasError &amp;&amp; result != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// 成功获取数据</span></span><br><span class="line">			Toast.makeText(x.app(), result, Toast.LENGTH_LONG).show();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="使用数据库-更多示例参考sample项目"><a href="#使用数据库-更多示例参考sample项目" class="headerlink" title="使用数据库(更多示例参考sample项目)"></a>使用数据库(更多示例参考sample项目)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Parent test = db.selector(Parent.class).where(<span class="string">"id"</span>, <span class="string">"in"</span>, <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>&#125;).findFirst();</span><br><span class="line"><span class="keyword">long</span> count = db.selector(Parent.class).where(<span class="string">"name"</span>, <span class="string">"LIKE"</span>, <span class="string">"w%"</span>).and(<span class="string">"age"</span>, <span class="string">"&gt;"</span>, <span class="number">32</span>).count();</span><br><span class="line">List&lt;Parent&gt; testList = db.selector(Parent.class).where(<span class="string">"id"</span>, <span class="string">"between"</span>, <span class="keyword">new</span> String[]&#123;<span class="string">"1"</span>, <span class="string">"5"</span>&#125;).findAll();</span><br></pre></td></tr></table></figure>
<h3 id="绑定图片-更多示例参考sample项目"><a href="#绑定图片-更多示例参考sample项目" class="headerlink" title="绑定图片(更多示例参考sample项目)"></a>绑定图片(更多示例参考sample项目)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">x.image().bind(imageView, url, imageOptions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// assets file</span></span><br><span class="line">x.image().bind(imageView, <span class="string">"assets://test.gif"</span>, imageOptions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// local file</span></span><br><span class="line">x.image().bind(imageView, <span class="keyword">new</span> File(<span class="string">"/sdcard/test.gif"</span>).toURI().toString(), imageOptions);</span><br><span class="line">x.image().bind(imageView, <span class="string">"/sdcard/test.gif"</span>, imageOptions);</span><br><span class="line">x.image().bind(imageView, <span class="string">"file:///sdcard/test.gif"</span>, imageOptions);</span><br><span class="line">x.image().bind(imageView, <span class="string">"file:/sdcard/test.gif"</span>, imageOptions);</span><br><span class="line"></span><br><span class="line">x.image().bind(imageView, url, imageOptions, <span class="keyword">new</span> Callback.CommonCallback&lt;Drawable&gt;() &#123;...&#125;);</span><br><span class="line">x.image().loadDrawable(url, imageOptions, <span class="keyword">new</span> Callback.CommonCallback&lt;Drawable&gt;() &#123;...&#125;);</span><br><span class="line">x.image().loadFile(url, imageOptions, <span class="keyword">new</span> Callback.CommonCallback&lt;File&gt;() &#123;...&#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="关于libwebpbackport"><a href="#关于libwebpbackport" class="headerlink" title="关于libwebpbackport"></a>关于libwebpbackport</h3><ul>
<li>部分4.x的机型对webp格式的支持仍然有问题, 需要借助webp.</li>
<li>webp来自:<a href="https://github.com/webmproject/libwebp" target="_blank" rel="external">https://github.com/webmproject/libwebp</a></li>
<li>webpbackport来自:<a href="https://github.com/alexey-pelykh/webp-android-backport" target="_blank" rel="external">https://github.com/alexey-pelykh/webp-android-backport</a></li>
<li>xUtils在使用webpbackport时为其添加了nativeDecodeFile的实现, 并修复其在Android 5.0及以上系统存在bug:<br>jni代码见: <a href="https://github.com/wyouflf/webp-android-backport/commits/master" target="_blank" rel="external">https://github.com/wyouflf/webp-android-backport/commits/master</a></li>
</ul>
<hr>
<h3 id="关于作者"><a href="#关于作者" class="headerlink" title="关于作者"></a>关于作者</h3><ul>
<li>Email： <a href="&#109;&#x61;&#105;&#108;&#x74;&#x6f;&#x3a;&#119;&#121;&#x6f;&#x75;&#102;&#x6c;&#102;&#64;&#113;&#113;&#x2e;&#99;&#x6f;&#x6d;">&#119;&#121;&#x6f;&#x75;&#102;&#x6c;&#102;&#64;&#113;&#113;&#x2e;&#99;&#x6f;&#x6d;</a>, <a href="&#109;&#x61;&#x69;&#x6c;&#116;&#111;&#x3a;&#119;&#x79;&#x6f;&#x75;&#102;&#x6c;&#102;&#64;&#103;&#x6d;&#97;&#x69;&#x6c;&#x2e;&#99;&#111;&#109;">&#119;&#x79;&#x6f;&#x75;&#102;&#x6c;&#102;&#64;&#103;&#x6d;&#97;&#x69;&#x6c;&#x2e;&#99;&#111;&#109;</a></li>
<li>有任何建议或者使用中遇到问题都可以给我发邮件, 你也可以加入QQ群：330445659(已满), 275967695, 257323060,<br>384426013, 176778777, 169852490, 261053948, 330108003, 技术交流，idea分享 <em>_</em></li>
</ul>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
        
  
  <div class="tags">
    <a href="/tags/XUtils3/">XUtils3</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Buscar">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Entradas Recientes</h3>
  <ul class="entry">
    
      <li>
        <a href="/2016/04/26/XUtils的简单介绍/">XUtils的简单介绍</a>
      </li>
    
      <li>
        <a href="/2016/03/17/Fresco详解/"></a>
      </li>
    
      <li>
        <a href="/2016/03/02/使用GithubPages-Hexo搭建免费博客（三）/">使用GithubPages-Hexo搭建免费博客（三）</a>
      </li>
    
      <li>
        <a href="/2016/02/26/使用GithubPages-Hexo搭建免费博客（二）/">使用GithubPages-Hexo搭建免费博客（二）</a>
      </li>
    
      <li>
        <a href="/2016/02/25/使用GithubPages-Hexo搭建免费博客（一）/">使用GithubPages-Hexo搭建免费博客_Mac（一）</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Etiquetas</h3>
  <ul class="entry">
  
    <li><a href="/tags/Hexo/">Hexo</a><small>3</small></li>
  
    <li><a href="/tags/XUtils3/">XUtils3</a><small>1</small></li>
  
    <li><a href="/tags/博客/">博客</a><small>3</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">Nube de Etiquetas</h3>
  <div class="entry">
    <a href="/tags/Hexo/" style="font-size: 20px;">Hexo</a> <a href="/tags/XUtils3/" style="font-size: 10px;">XUtils3</a> <a href="/tags/博客/" style="font-size: 20px;">博客</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  <p>
  
  &copy; 2016 Xiaobo Hu
  
  All rights reserved.</p>
  <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</div>
<div class="clearfix"></div>

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id='bg'></div>
</body>
</html>